# OSU Microbenchmarks

## Purpose and Description
The OSU Microbenchmark collection represents a suite of tests used to measure MPI performance in distributed computing systems. The tests herein include measurements of network latency (PingPong test), bandwidth rates across pairs of processes, collective communication tests (allreduce and all-to-all), and accelerator-based all-to-all and message rate tests.

## Licensing Requirements

The OSU Microbenchmark collection is available under BSD licensing. Further information can be located here: https://mvapich.cse.ohio-state.edu/static/media/mvapich/LICENSE-OMB.txt

## Other Requirements
While returned results may use any MPI distribution, we request that at least one returned osu_mbw_mr test result be obtained with OpenMPI to demonstrate OpenMPI functionality.

## How to build

We require a version of the OSU Micro-Benchmarks >= 7.4. The micro-benchmarks are downloaded from the following webpage: https://mvapich.cse.ohio-state.edu/benchmarks/ - the micro-benchmarks are compiled according to a standard 'configure' 'make' 'make install' pipeline. An example build/configuration script is located in the 'osu-scripts' directory, labelled as 'build.sh'. With a valid MPI distribution installed, the build script should install the micro-benchmarks without any further configuration steps. As the final step, the executables for the required OSU Micro-benchmarks are copied to the current working directory.

## How to run

Example scripts for both CPU-only and accelerated architectures are provided in the 'osu-scripts' directory, where there are example scripts provided for each OSU Micro-benchmark that is required. Note, these example scripts are formatted for the SLURM Job Scheduler, but this is not a requirement. Run requirements are listed below.

## Run Definitions and Requirements

### CPU Run Requirements
The table below details the required tests (alltoall, allreduce, latency, osu_mbw_mr) on CPU architecture. Minimum requirements are listed below. The OSU micro-benchmarks are required to be run up to a message size of 65536kb (65mb), and for each micro-benchmark to be run a minimum of 5 times each in order to collect an average of the results.


| Test          | Description                    | Nodes Used | Ranks Used          |
|---------------|--------------------------------|------------|---------------------|
| osu_latency   | Latency (PingPong)            | 2          | 1 Per Node          |
| osu_mbw_mr    | Multi-Bandwidth & Message Rate | 2          | At Least 80% Available Cores Per Node |
| osu_allreduce | All Reduce MPI Operations      | All        | At Least 80% Available Cores Per Node |
| osu_alltoall  | All-To-All MPI Operations      | All        | 1 Per Nic           |

### Accelerated Run Requirements

A successful run of the OSU Micro-benchmarks on an accelerated architecture is defined as a run of the following two tests (alltoall, osu-mbw-mr) executed on an accelerated architecture. The OSU micro-benchmarks are required to be run up to a message size of 65536kb (65mb), and for each test to be run a minimum of 5 times each in order to collect an average of the results.

| Test          | Description                    | Nodes Used | Ranks Used        |
|---------------|--------------------------------|------------|-------------------|
| osu_mbw_mr    | Multi-Bandwidth & Message Rate | 2          | 1 Per Accelerator |
| osu_alltoall  | All-To-All MPI Operations      | All        | 1 Per Accelerator |



## Benchmark data/results to return

When the results from a given test are output, a table will be displayed containing the relevant information for the relevant OSU benchmark. Latency (PingPong), Allreduce, and Alltoall will return latency information associated with the given operations, the Multi-bandwidth/message rate test will return a table that contains both the bandwidth and number of messages successfully sent at a given message size. 

### Results To Return
Example results generated by the tests are located in the directory 'example-results' and are labelled according to OSU micro-benchmark. The average of results for each message size for each test should be returned in the associated benchmark reporting spreadsheet. 